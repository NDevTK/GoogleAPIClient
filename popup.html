<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>API Security Researcher</title>
    <link rel="stylesheet" href="lib/prism-theme.css" />
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <header>
      <h1>API Security Researcher</h1>
      <div class="toolbar">
        <button id="btn-clear" title="Clear All Data">üóëÔ∏è</button>
      </div>
    </header>

    <nav>
      <button class="tab active" data-panel="response">Requests</button>
      <button class="tab" data-panel="send">Send</button>
      <button class="tab" data-panel="security">Vulns</button>
      <button class="tab" data-panel="data">Keys</button>
    </nav>

    <!-- Security Panel -->
    <section id="panel-security" class="panel">
      <div class="empty" id="security-empty">No security findings yet.</div>
      <div id="security-findings"></div>
    </section>

    <!-- Data Panel -->
    <section id="panel-data" class="panel">
      <button
        class="btn-export"
        id="btn-export-data"
        title="Copy all data as JSON"
      >
        Copy
      </button>

      <div class="empty" id="data-empty">No data captured yet.</div>
      <div id="data-keys"></div>
    </section>

    <!-- Send Panel -->
    <section id="panel-send" class="panel">
      <p class="hint">Select a method to load field info.</p>

      <div id="send-controls">
        <div class="service-row">
          <select id="spec-service-select">
            <option value="">All Services</option>
          </select>
          <button id="btn-export-spec" class="btn-spec" type="button" title="Export as OpenAPI">Export</button>
          <button id="btn-import-spec" class="btn-spec" type="button" title="Import OpenAPI spec">Import</button>
          <input id="import-spec-file" type="file" accept=".json,.yaml,.yml" class="hidden" />
        </div>
        <select id="send-ep-select">
          <option value="">-- select method --</option>
        </select>
      </div>

      <div id="send-chain-info" class="hidden"></div>

      <details id="send-headers-section">
        <summary>Custom Headers</summary>
        <div id="send-headers-list"></div>
        <button id="btn-add-header" class="btn-small" type="button">
          + Add Header
        </button>
      </details>

      <div id="send-body-section">
        <div id="send-form-fields"></div>
        <textarea
          id="send-raw-body"
          class="hidden"
          placeholder='{"field": "value"} or base64 for protobuf'
        ></textarea>
        <div id="send-graphql-fields" class="hidden">
          <textarea
            id="send-gql-query"
            placeholder="query { user(id: 1) { name email } }"
            rows="4"
          ></textarea>
          <textarea
            id="send-gql-variables"
            placeholder='Variables (JSON): {"id": 1}'
            rows="2"
          ></textarea>
          <input
            id="send-gql-opname"
            type="text"
            placeholder="Operation name (optional)"
          />
        </div>
        <div id="send-ws-console" class="hidden">
          <div class="ws-console-header">
            <div class="ws-url-row">
              <span class="ws-label">WebSocket</span>
              <span id="ws-console-url" class="ws-url-value"></span>
            </div>
            <div class="ws-status-row">
              <span class="ws-label">Status:</span>
              <span id="ws-console-status"></span>
            </div>
          </div>
          <div id="ws-console-history" class="ws-history"></div>
          <textarea id="ws-console-input" placeholder="Type a message..." rows="4"></textarea>
          <button id="ws-console-send" type="button" class="ws-send-btn" disabled>Send Message</button>
        </div>
      </div>

      <div class="send-actions">
        <button id="btn-send" type="button">Send Request</button>
        <div class="export-row">
          <span class="export-label">Export:</span>
          <button id="btn-copy-curl" class="btn-export" type="button">curl</button>
          <button id="btn-copy-fetch" class="btn-export" type="button">fetch</button>
          <button id="btn-copy-python" class="btn-export" type="button">Python</button>
        </div>
      </div>

      <div id="send-response" class="hidden send-response-section">
        <div class="section-header">Manual Send Result</div>
        <div id="send-response-status"></div>
        <details id="send-response-headers-section">
          <summary>Response Headers</summary>
          <table id="send-response-headers" class="auth-table"></table>
        </details>
        <div id="send-response-body"></div>
      </div>
    </section>


    <!-- Response Panel -->
    <section id="panel-response" class="panel active">
      <div id="response-log-container">
        <div class="section-header flex-between">
          <div class="flex-row">
            <span>Request Log</span>
            <select id="log-tab-filter" class="log-filter-select">
              <option value="active">Active Tab</option>
              <option value="all">All Tabs</option>
            </select>
          </div>
          <div class="flex-row">
            <button id="btn-export-har" class="btn-small" title="Export as HAR">HAR</button>
            <button id="btn-clear-log" class="btn-small">Clear</button>
          </div>
        </div>
        <input id="log-search" type="text" class="log-search-input" placeholder="Filter by URL, method, service..." />
        <div id="response-log" class="log-list"></div>
      </div>
    </section>

    <script src="lib/protobuf.js"></script>
    <script src="lib/discovery.js"></script>
    <script src="lib/prism.js" data-manual></script>
    <script src="popup.js"></script>
  </body>
</html>
